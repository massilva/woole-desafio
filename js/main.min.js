!function(e){!function(){"use strict";$(document).ready(function(){function e(e){var t,a;d[e._leaflet_id]={};for(t in d)a=l.getLayer(t),d[t][e._leaflet_id]=a===e?1/0:a.getLatLng().distanceTo(e.getLatLng()),d[e._leaflet_id][t]=d[t][e._leaflet_id]}function t(e,t){var a,o,n,i,c,f,s,p,y=[],_=[],h=Object.keys(d),u=[];for(p=h.length-1;p>=0;--p)_[p]=1/0,u[p]=void 0;for(_[h.indexOf(""+e._leaflet_id)]=0,y.push(e);y.length;)for(i=y.shift(),c=Object.keys(d[i._leaflet_id]),p=c.length-1;p>=0;--p)f=c[p],s=d[i._leaflet_id][f],_[h.indexOf(f)]>_[h.indexOf(""+i._leaflet_id)]+s&&(_[h.indexOf(f)]!=1/0&&y.splice(y.indexOf(f),1),u[h.indexOf(f)]=i._leaflet_id,_[h.indexOf(f)]=_[h.indexOf(""+i._leaflet_id)]+s,y.push(l.getLayer(f)));for(a=t,o=u[h.indexOf(""+a._leaflet_id)];o;)n=l.getLayer(o),r.addLayer(new L.Polyline([a.getLatLng(),n.getLatLng()],{color:"red",weight:3,opacity:.5,smoothFactor:1})),a=n,o=u[h.indexOf(""+a._leaflet_id)]}var a,o,l,n,r,i,d={},c=0;a=L.map("mapa").setView([-13.0015785,-38.507568],18),o=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18}),o.addTo(a),r=new L.layerGroup,a.addLayer(r),l=new L.KML("data/pontos.kml",{async:!0}),l.on("loaded",function(o){a.fitBounds(o.target.getBounds()),n.limites[0]=l.getLayers()[0],l.eachLayer(function(o){e(o),o.on("click",function(){if(this.closePopup(),2==n.limites.length){var e,o=c%2;o||r.eachLayer(function(e){a.removeLayer(e)}),e=0===o?n.limites[0]:i,t(e,this),i=this,c++,c%2===0&&t(i,n.limites[1])}})})}),a.addLayer(l),n={layer:(new L.layerGroup).addTo(a),control:{},limites:[],count:0,placeholders:["Partida...","Chegada..."]},n.control=new L.Control.Search({url:"http://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],circleLocation:!1,markerLocation:!1,autoType:!1,autoCollapse:!0,textPlaceholder:"",minLength:2}).on("search_locationfound",function(t){var a,o=L.marker(t.latlng),r=n.count%2;r||n.layer.eachLayer(function(e){for(a in d[e._leaflet_id])delete d[e._leaflet_id][a];delete d[e._leaflet_id],n.layer.removeLayer(e)}),n.count++,n.layer.addLayer(o),n.limites[r]=o,$("#searchtext10").attr("placeholder",n.placeholders[r?0:1]),l.addLayer(o),e(o)}),a.addControl(n.control),$("#searchtext10").attr("placeholder",n.placeholders[0])})}()}(window);
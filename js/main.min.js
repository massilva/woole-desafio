!function(e){!function(){"use strict";$(document).ready(function(){function e(e){var t,a;d[e._leaflet_id]={};for(t in d)a=n.getLayer(t),d[t][e._leaflet_id]=a===e?1/0:a.getLatLng().distanceTo(e.getLatLng()),d[e._leaflet_id][t]=d[t][e._leaflet_id]}function t(e,t){var a,o,i,r,c,s,f,p,g=[],h=[],y=Object.keys(d),_=[];for(p=y.length-1;p>=0;--p)h[p]=1/0,_[p]=void 0;for(h[y.indexOf(""+e._leaflet_id)]=0,g.push(e);g.length;)for(r=g.shift(),c=Object.keys(d[r._leaflet_id]),p=c.length-1;p>=0;--p)s=c[p],f=d[r._leaflet_id][s],h[y.indexOf(s)]>h[y.indexOf(""+r._leaflet_id)]+f&&(h[y.indexOf(s)]!=1/0&&g.splice(g.indexOf(s),1),_[y.indexOf(s)]=r._leaflet_id,h[y.indexOf(s)]=h[y.indexOf(""+r._leaflet_id)]+f,g.push(n.getLayer(s)));for(a=t,o=_[y.indexOf(""+a._leaflet_id)];o;)i=n.getLayer(o),l.addLayer(new L.Polyline([a.getLatLng(),i.getLatLng()],{color:"blue",weight:3,opacity:.5,smoothFactor:1})),a=i,o=_[y.indexOf(""+a._leaflet_id)]}var a,o,n,i,l,r,d={},c=0,s=[L.icon({iconUrl:"css/images/bike-green.svg",iconSize:[24,24]}),L.icon({iconUrl:"css/images/race-flag.png",shadowUrl:"css/images/race-flag-shadow.png",iconSize:[32,32],shadowSize:[32,32]})];a=L.map("mapa").setView([-13.0015785,-38.507568],18),o=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18}),o.addTo(a),l=new L.layerGroup,a.addLayer(l),n=new L.KML("data/pontos.kml",{async:!0}),n.on("loaded",function(o){a.fitBounds(o.target.getBounds()),i.limites[0]=n.getLayers()[0],n.eachLayer(function(o){e(o),o.on("click",function(){if(this.closePopup(),2==i.limites.length){var e,o=c%2;o||l.eachLayer(function(e){a.removeLayer(e)}),e=0===o?i.limites[0]:r,t(e,this),r=this,c++,c%2===0&&t(r,i.limites[1])}})})}),a.addLayer(n),i={layer:(new L.layerGroup).addTo(a),control:{},limites:[],count:0,placeholders:["Partida...","Chegada..."]},i.control=new L.Control.Search({url:"http://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],circleLocation:!1,markerLocation:!1,autoType:!1,autoCollapse:!0,textPlaceholder:"",minLength:2}).on("search_locationfound",function(t){var a,o=i.count%2,l=L.marker(t.latlng,{icon:s[o]});o||i.layer.eachLayer(function(e){for(a in d[e._leaflet_id])delete d[e._leaflet_id][a];delete d[e._leaflet_id],i.layer.removeLayer(e)}),i.count++,i.layer.addLayer(l),i.limites[o]=l,$("#searchtext10").attr("placeholder",i.placeholders[o?0:1]),n.addLayer(l),e(l)}),a.addControl(i.control),$("#searchtext10").attr("placeholder",i.placeholders[0])})}()}(window);